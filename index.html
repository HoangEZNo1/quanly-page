
Ôªø<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω & Xo√° b√†i vi·∫øt Fanpage</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .post-item {
      margin: 10px 0; padding: 10px;
      border: 1px solid #ccc; border-radius: 8px;
      background: #f9f9f9;
    }
    img { max-width: 200px; margin-top: 10px; }
    button { margin-top: 10px; padding: 10px; font-size: 14px; }
    input[type="date"] { margin-right: 10px; }
  </style>
</head>
<body>

  <h2>üîê ƒêƒÉng nh·∫≠p ƒë·ªÉ qu·∫£n l√Ω Fanpage</h2>
  <button onclick="loginWithFacebook()">ƒêƒÉng nh·∫≠p Facebook</button>

  <div id="pages" style="margin-top: 20px;"></div>

  <div id="filters" style="margin-top: 20px; display: none;">
    <h3>L·ªçc theo ng√†y:</h3>
    T·ª´: <input type="date" id="fromDate">
    ƒê·∫øn: <input type="date" id="toDate">
    <button onclick="loadPosts(selectedPageId)">L·ªçc b√†i vi·∫øt</button>
  </div>

  <div id="posts" style="margin-top: 20px;"></div>

  <script>
    let accessTokenByPage = {};
    let selectedPageId = null;

    window.fbAsyncInit = function() {
      FB.init({
        appId      : '941231771441534', // ‚ö†Ô∏è Thay App ID
        cookie     : true,
        xfbml      : true,
        version    : 'v19.0'
      });

      FB.AppEvents.logPageView();
    };

    (function(d, s, id){
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "https://connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    function loginWithFacebook() {
      FB.login(function(response) {
        if (response.authResponse) {
          loadPages();
        } else {
          alert("B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p.");
        }
      }, {
        scope: 'pages_manage_posts,pages_read_engagement,pages_show_list'
      });
    }

    function loadPages() {
      FB.api('/me/accounts', function(response) {
        if (response && response.data) {
          let html = "<h3>Ch·ªçn Fanpage:</h3>";
          response.data.forEach(page => {
            accessTokenByPage[page.id] = page.access_token;
            html += `<button onclick="selectPage('${page.id}')">${page.name}</button><br><br>`;
          });
          document.getElementById('pages').innerHTML = html;
        }
      });
    }

    function selectPage(pageId) {
      selectedPageId = pageId;
      document.getElementById('filters').style.display = 'block';
      loadPosts(pageId);
    }

    function loadPosts(pageId) {
      let token = accessTokenByPage[pageId];
      let fromDate = document.getElementById('fromDate').value;
      let toDate = document.getElementById('toDate').value;

      let since = fromDate ? `&since=${new Date(fromDate).getTime() / 1000}` : '';
      let until = toDate ? `&until=${new Date(toDate).getTime() / 1000}` : '';

      FB.api(`/${pageId}/posts?limit=20${since}${until}&access_token=${token}`, function(response) {
        if (response && response.data) {
          let html = "<h3>Ch·ªçn b√†i vi·∫øt ƒë·ªÉ xo√°:</h3>";
          response.data.forEach(post => {
            const postTime = new Date(post.created_time).toLocaleString();
            html += `
              <div class="post-item">
                <input type="checkbox" id="${post.id}" />
                <label for="${post.id}"><b>${postTime}</b></label><br>
                ${post.message ? `<p>${post.message}</p>` : ''}
                <button onclick="viewPost('${post.id}')">üîç Xem b√†i tr√™n Facebook</button>
                <div id="img-${post.id}"></div>
              </div>
            `;

            // L·∫•y ·∫£nh n·∫øu c√≥
            FB.api(`/${post.id}?fields=full_picture&access_token=${token}`, function(p) {
              if (p && p.full_picture) {
                document.getElementById(`img-${post.id}`).innerHTML =
                  `<img src="${p.full_picture}" alt="·∫¢nh b√†i vi·∫øt">`;
              }
            });
          });

          html += `<button onclick="deleteSelectedPosts('${pageId}')">üóëÔ∏è Xo√° b√†i ƒë√£ ch·ªçn</button>`;
          document.getElementById('posts').innerHTML = html;
        } else {
          document.getElementById('posts').innerHTML = "Kh√¥ng c√≥ b√†i vi·∫øt n√†o.";
        }
      });
    }

    function viewPost(postId) {
      window.open(`https://www.facebook.com/${postId}`, '_blank');
    }

    function deleteSelectedPosts(pageId) {
      let token = accessTokenByPage[pageId];
      let checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');

      if (checkboxes.length === 0) {
        alert("Ch∆∞a ch·ªçn b√†i n√†o ƒë·ªÉ xo√°!");
        return;
      }

      if (!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën xo√° c√°c b√†i ƒë√£ ch·ªçn?")) return;

      checkboxes.forEach(cb => {
        FB.api(`/${cb.id}?access_token=${token}`, 'DELETE', function(response) {
          if (response && response.success) {
            cb.parentElement.style.backgroundColor = "#ffe6e6";
            cb.parentElement.innerHTML += "<br>‚úÖ ƒê√£ xo√°";
          } else {
            cb.parentElement.innerHTML += "<br>‚ùå Kh√¥ng xo√° ƒë∆∞·ª£c";
          }
        });
      });
    }
  </script>
</body>
</html>

